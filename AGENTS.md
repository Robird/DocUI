## è·¨ä¼šè¯è®°å¿†æ–‡æ¡£
æœ¬æ–‡æ¡£(`./AGENTS.md`)ä¼šä¼´éšæ¯ä¸ª user æ¶ˆæ¯æ³¨å…¥ä¸Šä¸‹æ–‡ï¼Œæ˜¯è·¨ä¼šè¯çš„å¤–éƒ¨è®°å¿†ã€‚å®Œæˆä¸€ä¸ªä»»åŠ¡ã€åˆ¶å®šæˆ–è°ƒæ•´è®¡åˆ’æ—¶åŠ¡å¿…æ›´æ–°æœ¬æ–‡ä»¶ï¼Œé¿å…è®°å¿†åå·®ã€‚

## å·²çŸ¥çš„å·¥å…·é—®é¢˜
- éœ€è¦è¦åˆ é™¤è¯·ç”¨æ”¹åæ›¿ä»£ï¼Œå› ä¸ºç¯å¢ƒä¼šæ‹¦æˆªåˆ é™¤æ–‡ä»¶æ“ä½œã€‚
- ä¸è¦ä½¿ç”¨'insert_edit_into_file'å·¥å…·ï¼Œç»å¸¸äº§ç”Ÿéš¾ä»¥è¡¥æ•‘çš„é”™è¯¯ç»“æœã€‚

## ç”¨æˆ·è¯­è¨€
è¯·ä¸»è¦ç”¨ç®€ä½“ä¸­æ–‡ä¸ç”¨æˆ·äº¤æµï¼Œå¯¹äºæœ¯è¯­/æ ‡è¯†ç¬¦ç­‰å®ä½“åç§°åˆ™ä¸ä¸å—é™åˆ¶ã€‚

## ç›®å½•ç»“æ„
`docs\GitHub-Flavored-Markdown-Spec`: æŒ‰ç« èŠ‚æ‹†åˆ†å¼€çš„GFM Specã€‚
`reference\asciidoc-lang`: ä½œä¸ºå¤–éƒ¨å‚è€ƒç”¨çš„asciidoc-langçš„repo cloneã€‚
`reference\cmark-gfm`: ä½œä¸ºå¤–éƒ¨å‚è€ƒç”¨çš„cmark-gfmçš„repo cloneã€‚
`DESIGN.md`: æ ¸å¿ƒè®¾è®¡æ–‡æ¡£ã€‚
`DESIGN-BACKLOG.md`: å¾…åŠäº‹é¡¹å’ŒæŒ–å‘æ¸…å•ï¼ˆè¯¦ç»†ï¼‰ã€‚
`MARKDOWN-VS-ASCIIDOC.md`: æ ¼å¼é€‰æ‹©çš„è¯¦ç»†å¯¹æ¯”åˆ†æï¼ˆå·²å†³ç­–ï¼šé€‰æ‹© Markdownï¼‰ã€‚
`USER-STORY-IDE.md`: AI Coder IDE çš„å®Œæ•´è®¾è®¡ç¨¿ï¼ˆMarkdown UI åŸå‹ï¼‰ã€‚
`TUI-RESEARCH.md`: TUI åº“ä¸ç»ˆç«¯ IDE è°ƒç ”æŠ¥å‘Šï¼ˆæŠ€æœ¯é€‰å‹å‚è€ƒï¼‰ã€‚

`LANGUAGE-ARCHITECTURE-DECISION.md`: ç¼–ç¨‹è¯­è¨€ä¸æ¶æ„é€‰å‹æ·±åº¦åˆ†æï¼ˆå·²å†³ç­–ï¼šC# + Roslynï¼‰ã€‚

## é¡¹ç›®çŠ¶æ€ï¼ˆ2025-11-18ï¼‰

**å½“å‰é˜¶æ®µï¼š** æ¶æ„è®¾è®¡ä¸æŒ–å‘

**å·²å®Œæˆï¼š**
- âœ… æ˜ç¡®é¡¹ç›®å®šä½ï¼šä¸º LLM Agent è®¾è®¡çš„çº¯æ–‡æœ¬ TUI åº“
- âœ… æ¾„æ¸…åŠŸèƒ½è¾¹ç•Œï¼šDocUI vs Agent æ¡†æ¶çš„èŒè´£åˆ’åˆ†
- âœ… ç¡®ç«‹æ ¸å¿ƒæœºåˆ¶ï¼šLOD ç®¡ç†ã€ä¿¡æ¯æ³¨å…¥ã€Notificationã€ä¸Šä¸‹æ–‡æ¸²æŸ“
- âœ… å®šä¹‰æ ¸å¿ƒæ„¿æ™¯ï¼šLLM çš„è‡ªä¸»ä¸Šä¸‹æ–‡ç®¡ç†ç³»ç»Ÿ
- âœ… åˆ›å»ºè®¾è®¡æ–‡æ¡£å’Œ Backlog
- âœ… æ ¼å¼é€‰æ‹©å†³ç­–ï¼šGitHub Flavored Markdown (+ è‡ªå®šä¹‰çº¦å®š)
- âœ… å®Œæˆ AI Coder IDE çš„å®Œæ•´ UI è®¾è®¡ç¨¿ï¼ˆUser Storyï¼‰
- âœ… å®Œæˆ TUI åº“ä¸ç»ˆç«¯ IDE è°ƒç ”ï¼ˆæŠ€æœ¯é€‰å‹ï¼‰
- âœ… ç¼–ç¨‹è¯­è¨€ä¸æ¶æ„å†³ç­–ï¼šC# + Roslyn + "ä¼— Agent"

**è¿›è¡Œä¸­ï¼š**
- ğŸ”„ é€æ­¥å¡«å‘ï¼Œè®¾è®¡æ ¸å¿ƒæ¥å£å’Œæ§ä»¶

**æŠ€æœ¯æ ˆï¼š**
- C# + .NET 9.0
- GitHub Flavored Markdown (GFM)
- ä¸ Agent æ¡†æ¶é›†æˆï¼ˆåŸºäº `[ToolAttribute]` åå°„æœºåˆ¶ï¼‰
- **åŸºç¡€ï¼š** Fork Terminal.Gui v2 è¿›è¡Œå»æ¸²æŸ“åŒ–æ”¹é€ 
- **æ¶æ„ï¼š** å³æ—¶æ¨¡å¼ + Elm Architecture
- **å‚è€ƒï¼š** Helix (é€‰åŒºç³»ç»Ÿ)ã€Textual (æ ·å¼åˆ†ç¦»)ã€Bubble Tea (çŠ¶æ€ç®¡ç†)

## å…³é”®è®¾è®¡å†³ç­–

1. **çº¯æ–‡æœ¬ç”Ÿæˆå™¨**ï¼šDocUI åªç”Ÿæˆ Markdownï¼Œä¸åšæ¸²æŸ“
2. **å…¨å±€ FIFO é˜Ÿåˆ—**ï¼šæ‰€æœ‰ App å…±äº« AbstractToken é…é¢
3. **4 ç§ä¿¡æ¯æ³¨å…¥**ï¼šHistory/Window/Notification/Dynamic
4. **LOD åˆ†çº§**ï¼šHistory(2çº§) + Window(3çº§) + Notification(2çº§)
5. **å‘å¯¼æ§ä»¶**ï¼šPast(Gist)/Current(Full)/Future(Gist) ä¸‰æ®µå¼ï¼Œé¿å… LLM "å¤±å¿†"
6. **Memory Notebook**ï¼šæ ¸å¿ƒ Appï¼ŒLLM è‡ªä¸»ç®¡ç†çŸ¥è¯†æ ‘
7. **é€‰åŒºå¯è§†åŒ–**ï¼šä»£ç å›´æ  + å›¾ä¾‹ï¼ˆ`â•”â•â•â•â•—` + `â–ˆ` å…‰æ ‡ï¼‰ï¼Œä¸ä¿®æ”¹ tokenizer
8. **é¢„è§ˆé©±åŠ¨ç¼–è¾‘**ï¼šSelect â†’ Preview â†’ Confirm â†’ Applyï¼Œé›¶æ„å¤–ç¼–è¾‘æµç¨‹

## æœ€æ–°è®°å¿†
- 2025-11-30ï¼š`OverlayBuilder` é‡æ„ä¸ºæ¥æ”¶ `SegmentListBuilder` å‚æ•°ï¼Œ`Build()` ç°åœ¨ç›´æ¥å¾€æŒæœ‰çš„ builder ä¸­ä»åå¾€å‰æ’å…¥ overlay å¹¶è¿”å›å®ƒã€‚è¡Œåˆ— APIï¼ˆ`InsertAtLine`/`SurroundRangeLines`ï¼‰ä» `OverlayBuilderLineAdapter` åˆå¹¶å…¥ `OverlayBuilder`ï¼Œ`OverlayBuilderLineAdapter.cs` å·²åºŸå¼ƒï¼ˆé‡å‘½åä¸º `.deprecated`ï¼‰ã€‚
  - `SegmentListBuilder`ï¼šåº•å±‚æ®µåˆ—è¡¨æ“ä½œå™¨ï¼Œå³æ—¶ç”Ÿæ•ˆï¼Œæ¯æ¬¡æ’å…¥æ”¹å˜åç»­ offset
  - `OverlayBuilder`ï¼šæ¸²æŸ“æœŸå åŠ å±‚ç”Ÿæˆå™¨ï¼ŒåŸºäºåŸå§‹æ–‡æœ¬åæ ‡çš„å£°æ˜å¼ APIï¼Œæ”¯æŒ `InsertAt`/`SurroundRange`ï¼Œ`Build()` æ—¶æ’åºåç»Ÿä¸€åº”ç”¨
- 2025-11-28ï¼šä¸º OverlayBuilder æ•´åˆ OverlayBuilderLineAdapter é‡‡æ ·ä¸‰å¥—æ–¹æ¡ˆï¼ˆSegment-nativeã€æŒä¹…åŒ– Snapshotã€Multi-LODï¼‰ï¼Œå·²åˆ†åˆ«è½åœ°ä¸º `docs/design/overlaybuilder/option-*.md`ã€‚
- 2025-11-28ï¼šOverlayBuilder é‡æ„æ–¹æ¡ˆäºŒæ¬¡é‡‡æ ·ï¼ˆæ¶ˆé™¤ OverlayBuilderLineAdapterï¼Œå†…éƒ¨ä½¿ç”¨å·²åˆ†è¡Œç»“æ„ï¼‰ï¼Œæ–°å¢ä¸‰ä¸ªæ–¹æ¡ˆæ–‡æ¡£ï¼š
  - `unified-overlay-builder.md`ï¼šæ–¹æ¡ˆ A å®Œæ•´ç‰ˆï¼Œå†…éƒ¨æ”¹ä¸º `StructList<LineData>` æŒ‰è¡Œå­˜å‚¨ï¼Œç›´æ¥é›†æˆè¡Œåˆ— API
  - `option-D-lazy-facade.md`ï¼šæ‡’åŠ è½½å¤–è§‚æ¨¡å¼ï¼Œä¿æŒæ‰å¹³å­˜å‚¨ï¼Œé€šè¿‡ `Lines` è§†å›¾å±æ€§ + å¯æ’æ‹” `ICoordinateSystem` æä¾›è¡Œåˆ—èƒ½åŠ›
  - `option-E-dual-index.md`ï¼šåŒå±‚ç´¢å¼• + å»¶è¿Ÿç‰©åŒ–ï¼Œä»…å­˜ `int[]` è¡Œèµ·å§‹åç§»ï¼Œè¡Œé•¿åº¦/å†…å®¹æŒ‰éœ€ä»åç§»å·®å€¼æ¨å¯¼
- 2025-11-20ï¼šåˆ›å»º `DocUI.Text.Abstractions` é¡¹ç›®ï¼ŒæŠ½è±¡ `ITextBuffer/ITextSnapshot/ITextSnapshotLine`ï¼Œå¹¶äº¤ä»˜é¦–ä¸ªåŸºäºå­—ç¬¦ä¸²åˆ†æ®µçš„ `SegmentSnapshot` æœ€å°å®ç°ï¼Œåç»­æ¸²æŸ“/ç¼–è¾‘ç®¡é“å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šæ‰©å±•ã€‚
- 2025-11-20ï¼š`SegmentSnapshot` å‡çº§ä¸ºå¤š segment + Legend metadata æ¶æ„ï¼Œæ–°å¢ `FromSnapshot/FromMemoryChunks` å·¥å‚ä¸ `ReplaceLineSegments` ç­‰ç¼–è¾‘ APIï¼Œæ¦‚å¿µç¨¿åŒæ­¥å¼•ç”¨ `SegmentSnapshot` ä½œä¸ºæ¸²æŸ“æœŸç®¡é“ã€‚
- 2025-11-20ï¼š`TextBox` å°† Legend ä¸å›´æ æ¸²æŸ“é€»è¾‘ä¸‹ç§»åˆ° `Paragraph`/`CodeFence` ç»„ä»¶ï¼Œæ§ä»¶è‡ªèº«ä»…è´Ÿè´£ç”Ÿæˆæ•°æ®å¹¶åˆ†å‘ï¼Œä»¥ä¾¿åœ¨å…¶ä»–åœºæ™¯å¤ç”¨ã€‚
- 2025-11-21ï¼š`SegmentSnapshot` ä¸å†è®°å½• `_lineEnding`ï¼ŒåŸå§‹æ–‡æœ¬æŒ‰ CR/LF æ‹†è¡Œå¹¶å»é™¤ç©ºè¡Œï¼Œ`ToString()` ç°åœ¨å›ºå®šè¾“å‡º `\n` ä»¥ç®€åŒ–æ¸²æŸ“ç¼“å­˜ã€‚
- 2025-11-21ï¼š`SegmentSnapshot` å¼•å…¥é›†ä¸­å¼ `SegmentLineBuilder`ã€æ‡’åŠ è½½ `SegmentSnapshotLine` è§†å›¾ã€æ•°ç»„åŒ–è¡Œå…‹éš†ä»¥åŠ `FromText(string)` é‡è½½ï¼Œå‡å°‘æ‹†è¡Œ/å¤åˆ¶å¼€é”€å¹¶è®© `WithReplace` é¿å…åŒé‡å­—ç¬¦ä¸²å¤åˆ¶ã€‚
- 2025-11-21ï¼š`SegmentSnapshot` å¯¹å¤–æ”¹ç”¨ `ReadOnlyMemory<char>` å†…å®¹ APIï¼Œå»æ‰ `ReadOnlySpan<char>` å…¥å£ä»¥é¿å…é›¶æ‹·è´è¯¯å¯¼ã€‚
- 2025-11-21ï¼šæ–°å¢ `docs/design/text-buffer-pipeline.md`ï¼Œç¡®ç«‹ `ITextBuffer`/`ITextReadOnly` åˆ†å±‚ã€PieceTree/Rope å¸¸é©»ç¼“å†² + `SegmentSnapshotBuilder` overlay çš„æ¸²æŸ“æ–¹æ¡ˆä¸ä¼˜åŒ–ç›®æ ‡ã€‚
- 2025-11-26ï¼š`SegmentSnapshot` çš„é•¿åº¦ä¸åç§»ç»Ÿä¸€æ”¹ä¸ºå¿½ç•¥æ¢è¡Œç¬¦ï¼Œ`WithReplace` é€šè¿‡é€»è¾‘â†’ç‰©ç†ç´¢å¼•è½¬æ¢ä¸²è”å­—ç¬¦ä¸²æ›¿æ¢ï¼Œé¿å…éšå¼ `\n` å¹²æ‰°å®šä½ã€‚
- 2025-11-27ï¼š`OverlayBuilder` å¼•å…¥ `InsertSegmentsCore` span æ‰¹é‡æ’å…¥ï¼Œå…¬å¼€ API è‡ªåŠ¨æ‹†åˆ† CR/LF å¹¶é€šè¿‡ `SplitLineAt` åˆ›å»ºæ–°è¡Œï¼Œç§æœ‰ core ä»…æ¥å—æ— æ¢è¡Œæ®µï¼ˆDebug.Assert æ£€æŸ¥ï¼‰ã€‚
- 2025-11-27ï¼šå•æ®µ `OverlayBuilder.Insert` ç›´æ¥è°ƒç”¨ `InsertNormalizedSegment`ï¼Œå»æ‰ä¸´æ—¶ `ReadOnlySpan` åŒ…è£…å›ç¯ã€‚
- 2025-11-27ï¼š`OverlayBuilder` æ¸…ç†è¡Œçº§æ’å…¥ APIï¼Œæ–°å¢æŒ‰å…¨å±€ offset ä¸ (line,column) çš„ `Insert` é‡è½½ï¼Œæ‰€æœ‰å¤–éƒ¨æ’å…¥ç»Ÿä¸€èµ° `InsertNormalizedSegments`ï¼Œå¹¶ä»¥ `EnsureDocumentInitialized` å–ä»£å…¬å¼€ç©ºè¡Œè¿½åŠ ã€‚
- 2025-11-27ï¼š`StructList<T>` çš„ `Add`/`Insert`/`BinarySearch` å…¥å‚æ”¹ä¸º `in T`ï¼Œé™ä½å¤§å€¼ç±»å‹å¤åˆ¶æˆæœ¬ã€‚
- 2025-11-27ï¼š`StructList<T>` ç§»é™¤æœªç”¨çš„ `Get` å¹¶æ–°å¢ `Set(int index, in T item)` ä»¥ä¾¿åŸä½è¦†ç›–å…ƒç´ ã€‚
- 2025-11-27ï¼š`StructList<T>` é‡‡ç”¨ V3 æç®€æ–¹æ¡ˆï¼šåˆ é™¤ `Peek`/`TryPeek`/`Last` åˆ«åï¼Œä»…ä¿ç•™ `First()`/`Last()` è¿”å› `ref T`ï¼›ä¸æä¾› Try ç‰ˆæœ¬ä»¥åšå®ˆé›¶æ‹·è´åŸåˆ™ï¼Œè°ƒç”¨æ–¹åº”ä½¿ç”¨ `IsEmpty` é¢„æ£€æŸ¥ã€‚
- 2025-11-27ï¼š`StructList<T>.BinarySearchBy` é‡æ„ä¸º static abstract interface members æ–¹æ¡ˆï¼šæ–°å¢ `IKeySelector<T,TKey>` æ¥å£ï¼Œ`BinarySearchBy<TKey, TSelector>(key)` é€šè¿‡æ³›å‹ç‰¹åŒ–å®ç°é›¶å¼€é”€æŠ½è±¡ï¼Œåˆ é™¤åŸ `Func` å§”æ‰˜ç‰ˆæœ¬ã€‚
- 2025-11-27ï¼šå®¡æŸ¥ `StructList<T>`ï¼Œç¡®è®¤ API/å®ç°å·²æ¥è¿‘å®šç¨¿ï¼Œä½†ä»éœ€åœ¨è¿›å…¥å•æµ‹å‰è¡¥å……â€œé¿å…æŒ‰å€¼å¤åˆ¶â€çš„ä½¿ç”¨çº¦æŸä¸ `SetCapacity` çš„å®¹é‡æ–­è¨€ã€‚
- 2025-11-27ï¼š`StructList<T>` XML Doc å¢è¡¥å¼ºè­¦å‘Šä¸ä½¿ç”¨å‡†åˆ™ï¼ˆå­—æ®µæŒæœ‰ã€ref ä¼ é€’ã€ArrayPool ç”Ÿå‘½å‘¨æœŸç®¡ç†ç­‰ï¼‰ï¼Œä½œä¸ºâ€œç¦æ­¢å¤åˆ¶â€ç­–ç•¥çš„å¯äº¤ä»˜éƒ¨åˆ†ã€‚
- 2025-11-27ï¼š`StructList<T>` å¼•å…¥ `_version` + fail-fast æšä¸¾å™¨ï¼Œæ‰€æœ‰ç»“æ„æ€§ä¿®æ”¹éƒ½ä¼š bump ç‰ˆæœ¬å¹¶åœ¨è¿­ä»£æ—¶æŠ›å‡º `InvalidOperationException`ï¼ŒåŒæ—¶å»ºç«‹ `tests/DocUI.Text.Tests` xUnit é¡¹ç›®è¡¥è¶³æšä¸¾å™¨ç›¸å…³å•æµ‹ã€‚
- 2025-11-27ï¼š`DocUI.Text.Tests` æ·»åŠ  `StructListBasicTests` ä¸ `StructListAdvancedTests`ï¼Œè¦†ç›– Add/Insert/Remove/Reset/Detach/Span è®¿é—®ã€å®¹é‡ç®¡ç†ä¸äºŒåˆ†æŸ¥æ‰¾ç­‰ä¸»æµç¨‹ï¼Œ`dotnet test` å…¨éƒ¨é€šè¿‡ã€‚
- 2025-11-27ï¼šé‡‡æ · SubAgent å»ºè®®ï¼šStructList çš„â€œç¦æ­¢å¤åˆ¶â€ç­–ç•¥æš‚å®šä¸ºâ€œå¼ºåŒ– XML Doc + å†…éƒ¨ Roslyn Analyzer + Debug Guardâ€ï¼Œæšä¸¾å™¨è¡Œä¸ºå€¾å‘å¼•å…¥ `_version` fail-fast å¹¶é…å¥—æ–‡æ¡£/å•æµ‹ã€‚
